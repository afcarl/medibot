(function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=function(a,b){return function(){return a.apply(b,arguments)}};Medibot.Collections||(Medibot.Collections={}),Medibot.Collections.Notifications=Backbone.Collection.extend({model:Medibot.Models.Notification}),Medibot.Collections.Sensors=Backbone.Collection.extend({model:Medibot.Models.Sensor}),Medibot.Models||(Medibot.Models={}),Medibot.Models.Joystick=Backbone.Model.extend({defaults:[0,0],initialize:function(){return this.on("change",function(a){return Medibot.socket.emit("control:move",a)})}}),Medibot.Models.Compass=Backbone.Model.extend({defaults:{heading:0,bearing:"North",raw:{x:0,y:0,z:0},scaled:{x:0,y:0,z:0}}}),Medibot.Models.Sonar=Backbone.Model.extend({defaults:{scanner:{steps:20,range:[0,180],angle:0},ping:{distance:0,min:0,max:140}}}),Medibot.Models.Notification=Backbone.Model.extend({defaults:{body:"",type:"default",timestamp:Date.now(),priority:0}}),Medibot.Models.Motor=Backbone.Model.extend({defaults:{left:0,right:0}}),Medibot.Models.Sensor=Backbone.Model.extend({defaults:{min:0,max:255},value:0,progress:function(){return this.get("value")/this.get("max")}}),$.fn.animationComplete=function(a){var b;if(!Modernizr.cssanimations)return setTimeout(a,0),$(this);b="animationend webkitAnimationEnd";if($.isFunction(a))return $(this).one(b,a)},$.fn.animateCSS=function(a,b){return a||(a="none"),$(this).addClass("animated "+a).animationComplete(function(){$(this).removeClass("animated "+a);if(b)return b()}),$(this)},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1e3/60)}}(),$("body").on("touchmove",function(a){return a.preventDefault()}),Raphael.fn.sector=function(a,b,c,d,e){var f,g,h,i,j;return f=Math.PI/180,g=a+c*Math.cos(-d*f),h=a+c*Math.cos(-e*f),i=b+c*Math.sin(-d*f),j=b+c*Math.sin(-e*f),this.path(["M",a,b,"L",g,i,"A",c,c,0,+(e-d>180),0,h,j,"z"])},Raphael.fn.roundedRectangle=function(a,b,c,d,e,f,g,h){var i;return i=[],i=i.concat(["M",a,e+b,"Q",a,b,a+e,b]),i=i.concat(["L",a+c-f,b,"Q",a+c,b,a+c,b+f]),i=i.concat(["L",a+c,b+d-g,"Q",a+c,b+d,a+c-g,b+d]),i=i.concat(["L",a+h,b+d,"Q",a,b+d,a,b+d-h,"Z"]),this.path(i)},Medibot.Views||(Medibot.Views={}),Medibot.Views.Base=Backbone.View.extend({showFor:function(a,b){var c=this;return this.show(this.animation,function(){var b;return b=setTimeout(function(){return c.hide()},a*1e3),c.$el.on("mouseover",function(){return clearTimeout(b)}),c.$el.on("mouseleave",function(){return c.hide()})}),this},renderChild:function(a,b){return b||(b=this.$el),b.append(a.render().el)},toggle:function(){return this.isVisible?this.hide():this.show()},show:function(a,b){var c=this;return this.animation=a||this.animation,this.animate(this.animation),this.on("animation:complete",function(){c.isVisible=!0,c.trigger("visibility:showing"),c.$el.addClass("active");if(b)return b()})},hide:function(a,b){var c=this;a==null&&(a=this.reverseAnimation(this.animation));if(this.isVisible&&!this.isAnimating)return this.animate(a),this.on("animation:complete",function(){c.isVisible=!1,c.$el.removeClass("active"),c.trigger("visibility:hidden");if(b)return b()})},transition:function(a){var b=this;return this.transition=a||this.transition,this.trigger("transition:started"),this.$el.transitionCSS(a,function(){return b.$el.addClass("active"),b.trigger("transition:complete")})},animate:function(a){var b=this;if(!this.isAnimating)return this.isAnimating=!0,this.trigger("animation:started"),this.$el.animateCSS(a,function(){return b.isAnimating=!1,b.trigger("animation:complete")})},reverseAnimation:function(a){var b,c,d,e,f,g;a==null&&(a=""),c=["Out","In","Down","Up","Right","Left"],e=["In","Out","Up","Down","Left","Right"],d=a;for(f=0,g=c.length;f<g;f++)b=c[f],a.indexOf(b)!==-1&&(d=d.replace(b,e[f]));return d}}),Medibot.Views.RaphaelBase=Backbone.View.extend({tagName:"div",colors:{bg:"rgb(26, 56, 59)",highlight:"rgb(64, 215, 220)",highlight2:"rgba(255, 102, 124)",transparent:"rgba(64, 215, 220, 0.1)",invisible:"rgba(64, 215, 220, 0)",warning:"rgba(244, 54, 6)",glow:"rgb(35,41,37)"},initialize:function(a){return this.options=a!=null?a:{},_.bindAll(this,"draw"),this.model.on("change",this.draw),_.defaults(this.options,{animation:"<>",lineWidth:8,digit:!1,label:!1})},resize:function(a,b){return this.paper.clear(),this.options.width=this.width,this.options.height=this.height,this.render()},render:function(){return this.options.label&&this.$el.append("<h3 class='section-label'>"+this.options.label+"</h3>"),this.options.radius?(this.center=this.options.radius+this.options.lineWidth,this.paper=Raphael(this.el,this.center*2,this.center*2)):(this.cx=this.options.width/2+this.options.lineWidth*2,this.cy=this.options.height/2+this.options.lineWidth*2,this.paper=Raphael(this.el,this.options.width,this.options.height)),this.options.digit&&(this.$el.append('<p class="digit">0</p>'),this.$digit=this.$(".digit")),this.paper.customAttributes.arc=function(a,b,c,d,e){var f,g,h,i,j;return g=360/d*c,f=(90-g)*Math.PI/180,i=a+e*Math.cos(f),j=b-e*Math.sin(f),d===c?h=[["M",a,b-e],["A",e,e,0,1,1,a-.01,b-e]]:h=[["M",a,b-e],["A",e,e,0,+(g>180),1,i,j]],{path:h}}}}),Medibot.Views||(Medibot.Views={}),Medibot.Views.BlockGraph=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.className="block-graph section",c.prototype.initialize=function(a){return this.options=a!=null?a:{},c.__super__.initialize.apply(this,arguments),this.options.spacing=this.options.spacing||4,this.options.direction=this.options.direction||"right"},c.prototype.draw=function(){var a,b,c,d,e,f,g,h,i,j,k;g=this.model.progress(),k=[];for(h=i=0,j=this.options.rows-1;0<=j?i<=j:i>=j;h=0<=j?++i:--i)k.push(function(){var i,j,k;k=[];for(b=i=0,j=this.options.cols-1;0<=j?i<=j:i>=j;b=0<=j?++i:--i)a=this.blocks[h][b],f=a.attr("fill-opacity"),this.options.direction==="up"&&(e=Math.floor(this.options.rows-g*this.options.rows),c=f<1&&h>=e,d=f>0&&h<=e),this.options.direction==="right"&&(e=Math.floor(g*this.options.cols),c=f<1&&b<=e,d=f>0&&b>=e),c?k.push(a.animate({"fill-opacity":1},200,this.options.animation)):d?k.push(a.animate({"fill-opacity":0},200,this.options.animation)):k.push(void 0);return k}.call(this));return k},c.prototype.render=function(){var a,b,d,e,f,g,h,i,j,k,l,m,n,o;c.__super__.render.apply(this,arguments),this.blocks=new Array(this.options.rows),m=this.blocks;for(i=0,l=m.length;i<l;i++)a=m[i],this.blocks[i]=new Array(this.options.cols);d=Math.floor(this.options.width/this.options.cols)-this.options.lineWidth-this.options.spacing,b=Math.floor(this.options.height/this.options.rows)-this.options.lineWidth-this.options.spacing,h=this.options.spacing;for(f=j=0,n=this.options.rows-1;0<=n?j<=n:j>=n;f=0<=n?++j:--j){g=this.options.spacing;for(e=k=0,o=this.options.cols-1;0<=o?k<=o:k>=o;e=0<=o?++k:--k)a=this.paper.rect(g,h,d,b).attr({stroke:this.colors.bg,fill:this.colors.highlight,"fill-opacity":0,"stroke-width":this.options.lineWidth}),this.blocks[f][e]=a,g+=d+this.options.spacing;h+=b+this.options.spacing}return this},c}(Medibot.Views.RaphaelBase),Medibot.Views||(Medibot.Views={}),Medibot.Views.CircularGraph=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.className="circular-graph section",c.prototype.draw=function(){var a,b;b=this.model.get("value"),a=this.model.get("max");if(!(b>a))return this.$digit.text(b),this.circle.animate({arc:[this.center,this.center,b,a,this.options.radius]},200,this.options.animation)},c.prototype.render=function(){return c.__super__.render.apply(this,arguments),this.bg=this.paper.circle(this.center,this.center,this.options.radius).attr({stroke:this.colors.bg,"stroke-width":this.options.lineWidth}),this.circle=this.paper.path().attr({stroke:this.colors.highlight,"stroke-width":this.options.lineWidth,arc:[this.center,this.center,0,255,this.options.radius]}),this},c}(Medibot.Views.RaphaelBase),Medibot.Views||(Medibot.Views={}),Medibot.Views.Compass=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.className="compass section",c.prototype.draw=function(){return this.paper},c.prototype.render=function(){return c.__super__.render.apply(this,arguments),this.paper.circle(this.center,this.center,this.options.radius).attr({stroke:this.colors.bg,"stroke-width":this.options.lineWidth,"stroke-dasharray":"--","stroke-linecap":"butt"}),this.paper.path("M23.383,0C19.415,0,0,70.15,0,70.15l23.383-23.384L46.767,70.15C46.767,70.15,27.352,0,23.383,0z"),this},c}(Medibot.Views.RaphaelBase),Medibot.Views||(Medibot.Views={}),Medibot.Views.Hud=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.className="hud",c.prototype.template=Handlebars.templates.hud,c.prototype.initialize=function(){var a=this;return Medibot.socket=io.connect("http://localhost"),this.sensorModel=new Medibot.Models.Sensor,this.joystickModel=new Medibot.Models.Joystick,this.sonarModel=new Medibot.Models.Sonar,this.notifications=new Medibot.Collections.Notifications,Medibot.socket.on("read",function(b){return a.sensorModel.set(b.sensor),a.sonarModel.set(b.sonar)})},c.prototype.render=function(){return this.renderTemplate({}),this.$toolbar=this.$(".toolbar"),this.$video=this.$(".video-container"),this.renderChild(new Medibot.Views.Sensor({model:this.sensorModel,radius:20,digit:!0,label:"Battery"}),this.$toolbar),this.renderChild(new Medibot.Views.NotificationFooter({collection:this.notifications})),this.renderChild(new Medibot.Views.Sonar({model:this.sonarModel,lineWidth:1,radius:90,digit:!1,label:"Sonar"}),this.$toolbar),this.renderChild(new Medibot.Views.BlockGraph({model:this.sensorModel,height:20,width:120,rows:1,cols:10,lineWidth:1,direction:"right"}),this.$toolbar),this.renderChild(new Medibot.Views.Joystick({model:this.joystickModel,div:".video-container",width:640,height:320,lineWidth:1,digit:!1}),this.$video),this.renderChild(new Medibot.Views.Compass({model:this.sensorModel,lineWidth:1,radius:70})),this},c}(Medibot.Views.Base),Medibot.Views||(Medibot.Views={}),Medibot.fn={},Medibot.fn.constrain=function(a,b,c){return a<=c&&a>=b?a:a>c?c:b},Medibot.Views.Joystick=function(a){function d(){return this.end=c(this.end,this),this.move=c(this.move,this),this.start=c(this.start,this),d.__super__.constructor.apply(this,arguments)}return b(d,a),d.prototype.className="joystick",d.prototype.initialize=function(a){var b,c=this;return this.options=a!=null?a:{},b=$(".video-container"),_.defaults(this.options,{animation:"<>",lineWidth:8,digit:!0,frequency:100}),$(window).on("resize",function(){return b=$(c.options.div),c.resize(b.width(),b.height())})},d.prototype.start=function(){return this.control.animate({fill:this.colors.highlight2},300,"<>")},d.prototype.move=function(a,b){var c,d,e;return d=this.options.width/2,c=this.options.height/2,a=Medibot.fn.constrain(a,-d,d),b=Medibot.fn.constrain(b,-c,c),e=[a/d,b/c],this.model.set(e),this.control.attr({cx:this.cx+a,cy:this.cy+b})},d.prototype.end=function(){return this.control.animate({cx:this.cx,cy:this.cy,fill:this.colors.highlight},200,"backOut")},d.prototype.render=function(){return d.__super__.render.apply(this,arguments),this.bg=this.paper.rect(0,0,this.options.width,this.options.height).attr({stroke:this.colors.bg,"stroke-width":this.lineWidth}),this.home=this.paper.circle(this.cx,this.cy,30).attr({fill:this.colors.bg,stroke:!1}),this.control=this.paper.circle(this.cx,this.cy,30).attr({stroke:!1,fill:this.colors.highlight,opacity:.7,"stroke-width":this.options.lineWidth}),this.control.drag(this.move,this.start,this.end),this},d}(Medibot.Views.RaphaelBase),Medibot.Views||(Medibot.Views={}),Medibot.Views.NotificationFooter=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.tagName="div",c.prototype.template=Handlebars.templates.notification,c.prototype.className="notification media",c.prototype.animation="fadeInUp fast",c.prototype.initialize=function(a){return a==null&&(a={}),_.bindAll(this,"render"),this.collection.bind("add",this.render)},c.prototype.render=function(){var a;return this.collection.length>0&&(a=this.collection.first(),a.get("priority")>0&&(this.renderTemplate(a.toJSON()),this.showFor(5))),this},c}(Medibot.Views.Base),Medibot.Views||(Medibot.Views={}),Medibot.Views.Sensor=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.className="circular-graph section",c.prototype.tagName="div",c}(Medibot.Views.CircularGraph),Medibot.Views||(Medibot.Views={}),Medibot.Views.Sonar=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.className="sonar-graph section",c.prototype.draw=function(){var a,b,c;return c=this.model.get("scanner"),a=this.model.get("ping"),a.distance<a.max&&(b=this.paper.rect(a.distance/a.max*this.options.radius,this.center-this.options.lineWidth,5,5).rotate(c.angle,this.center,this.center-this.options.lineWidth).attr({fill:this.colors.highlight,stroke:!1}),b.animate({opacity:0},5e3,this.options.animation,function(){return b.remove()})),this.core.animate({"stroke-width":50,"stroke-opacity":0},500,this.options.animation,function(){return this.attr({"stroke-opacity":1,"stroke-width":0})}),this.beam.animate({transform:"R"+c.angle+","+this.center+","+(this.center-this.options.lineWidth)},1e3)},c.prototype.render=function(){var a,b,d,e,f,g,h;c.__super__.render.apply(this,arguments),this.paper.setSize(this.center*2,this.center),b=this.model.get("scanner"),a=b.range,e=b.steps,this.beam=this.paper.sector(this.center,this.center-this.options.lineWidth,this.options.radius,a[1]-e,a[1]).attr({fill:this.colors.transparent,stroke:!1}),this.core=this.paper.sector(this.center,this.center-this.options.lineWidth,5,a[0],a[1]).attr({fill:this.colors.highlight,stroke:this.colors.highlight,"stroke-width":0,"stroke-opacity":.2}),h=_.range(this.options.radius,10,-10);for(f=0,g=h.length;f<g;f++)d=h[f],this.paper.sector(this.center,this.center-this.options.lineWidth,d,a[0],a[1]).attr({stroke:this.colors.bg,"stroke-width":1,"stroke-opacity":1});return this},c}(Medibot.Views.RaphaelBase)}).call(this);